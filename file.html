<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greens Cafe ‚Äî Menu Order System</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div id="app"></div>

    <script>
        /***********************
         * Data & Mock Backend
         ***********************/
        const menuData = {
            "Beverages": [
                { id: 1, name: "Cappuccino", description: "Rich espresso with steamed milk foam", price: 3.5 },
                { id: 2, name: "Americano", description: "Espresso with hot water", price: 2.75 },
                { id: 3, name: "Iced Latte", description: "Chilled espresso with milk and ice", price: 4.0 }
            ],
            "Snacks": [
                { id: 11, name: "Garlic Bread", description: "Toasted bread with garlic butter", price: 2.5 },
                { id: 12, name: "Veg Sandwich", description: "Fresh veggies with pesto", price: 5.0 }
            ],
            "Desserts": [
                { id: 21, name: "Chocolate Brownie", description: "Warm brownie with ice-cream", price: 3.75 },
                { id: 22, name: "Cheesecake", description: "Classic creamy slice", price: 4.25 }
            ]
        };

        const mockUsers = {
            waiters: [ { name: 'Asha', uid: '1001234567', password: 'waiter123' }, { name: 'Ram', uid: '1009876543', password: 'waiter123' } ],
            owners: [ { name: 'Prashant', uid: '2000000001', password: 'owner123' } ]
        };

        let state = {
            view: 'landing', // 'landing' | 'roleSelect' | 'login' | 'customer' | 'waiter' | 'owner'
            currentRole: null, // 'waiter' | 'owner' | 'customer'
            currentUser: null,
            cart: [],
            orders: [
                { id: 501, date: '2025-11-30', tableNo: 'T3', items: 'Cappuccino x1', total: 3.50, status: 'pending', waiter: 'Asha' },
                { id: 502, date: '2025-11-29', tableNo: 'T1', items: 'Veg Sandwich x2', total: 10.00, status: 'completed', waiter: 'Ram' }
            ]
        };

        /***********************
         * State helpers
         ***********************/
        function setState(patch) {
            state = { ...state, ...patch };
            render();
            attachEventListeners(); // re-attach for inline handlers
        }

        /***********************
         * Utility functions
         ***********************/
        function formatCurrency(n) {
            return n.toFixed(2);
        }

        function calculateTotal() {
            return state.cart.reduce((s, it) => s + it.price * it.quantity, 0).toFixed(2);
        }

        function findMenuItemById(id) {
            for (const cat of Object.values(menuData)) {
                for (const item of cat) if (item.id === id) return item;
            }
            return null;
        }

        /***********************
         * Actions: Cart & Orders
         ***********************/
        function addToCart(itemPayload) {
            // itemPayload may be a plain object (from JSON string in templates)
            const id = Number(itemPayload.id || itemPayload);
            const menuItem = typeof itemPayload === 'object' ? itemPayload : findMenuItemById(id);
            if (!menuItem) return alert('Item not found');
            const existing = state.cart.find(i => i.id === menuItem.id);
            if (existing) existing.quantity++;
            else state.cart.push({ ...menuItem, quantity: 1 });
            setState({ cart: state.cart });
        }

        function removeFromCart(id) {
            state.cart = state.cart.filter(i => i.id !== id);
            setState({ cart: state.cart });
        }

        function updateQuantity(id, delta) {
            const it = state.cart.find(i => i.id === id);
            if (!it) return;
            it.quantity += delta;
            if (it.quantity <= 0) removeFromCart(id);
            else setState({ cart: state.cart });
        }

        function placeOrder() {
            if (state.cart.length === 0) return alert('Add items to cart first.');
            const newId = Math.floor(Math.random() * 900) + 1000;
            const total = Number(calculateTotal());
            const itemsDesc = state.cart.map(i => `${i.name} x${i.quantity}`).join(', ');
            const order = { id: newId, date: new Date().toISOString().slice(0,10), tableNo: 'T' + (Math.floor(Math.random()*10)+1), items: itemsDesc, total, status: 'pending', waiter: state.currentUser?.name || 'Unassigned' };
            state.orders.unshift(order);
            state.cart = [];
            setState({ orders: state.orders, cart: [] });
            alert('Order placed successfully! Order ID: #' + newId);
        }

        /***********************
         * Authentication
         ***********************/
        function handleLogin(uid, password, role) {
            if (role === 'waiter') {
                const user = mockUsers.waiters.find(u => u.uid === uid && u.password === password);
                if (user) {
                    setState({ currentUser: user, currentRole: 'waiter', view: 'waiter' });
                    return;
                }
            } else if (role === 'owner') {
                const user = mockUsers.owners.find(u => u.uid === uid && u.password === password);
                if (user) {
                    setState({ currentUser: user, currentRole: 'owner', view: 'owner' });
                    return;
                }
            }
            alert('Invalid credentials. Use demo credentials prefilled for testing.');
        }

        /***********************
         * Render functions (SPA-style)
         ***********************/
        function render() {
            const root = document.getElementById('app');
            if (!root) return;
            switch(state.view) {
                case 'landing': root.innerHTML = renderLanding(); break;
                case 'roleSelect': root.innerHTML = renderRoleSelect(); break;
                case 'login': root.innerHTML = renderLogin(); break;
                case 'customer': root.innerHTML = renderCustomer(); break;
                case 'waiter': root.innerHTML = renderWaiter(); break;
                case 'owner': root.innerHTML = renderOwner(); break;
                default: root.innerHTML = renderLanding();
            }
        }

        function renderLanding() {
            return `
                <div class="landing-page">
                    <div class="cafe-logo">
                        <img src="Greenlogo.png" alt="logo">
                    </div>
                    <div class="landing-content card">
                        <h1 class="cafe-name">Greens Cafe</h1>
                        <p class="cafe-tagline">"Where Every Sip Tells a Story"</p>
                        <p class="cafe-description">
                            Welcome to Greens Cafe, your perfect destination for exceptional coffee, delicious food, and warm
                            hospitality. Established in 2025, we serve the community with passion and dedication.
                        </p>

                        <div class="owner-info">
                            <h3>üè¢ About Our Establishment & Features ‚§µÔ∏è</h3>
                            <div class="owner-details">
                                <div class="owner-detail-item">
                                    <strong>Owner:</strong>
                                    <span>Prashant Shrestha</span>
                                </div>
                                <div class="owner-detail-item">
                                    <strong>Co-Owner:</strong>
                                    <span>Lana Lodes</span>
                                </div>
                                <div class="owner-detail-item">
                                    <strong>Restaurant Code:</strong>
                                    <span>MC-0484</span>
                                </div>
                                <div class="owner-detail-item">
                                    <strong>Contact:</strong>
                                    <span>+977-9705397845</span>
                                </div>
                                <div class="owner-detail-item">
                                    <strong>Location:</strong>
                                    <span>Manakamana college side, Birtamode Jhapa</span>
                                </div>
                                <div class="owner-detail-item">
                                    <strong>Operating Hours:</strong>
                                    <span>7:00 AM - 10:00 PM</span>
                                </div>
                            </div>
                        </div>

                        <div class="facilities-grid">
                            <div class="facility-card">
                                <div class="facility-icon">üåê</div>
                                <h4>Free WiFi</h4>
                                <p>High-speed internet for all customers</p>
                            </div>
                            <div class="facility-card">
                                <div class="facility-icon">üÖøÔ∏è</div>
                                <h4>Parking</h4>
                                <p>Ample parking space available</p>
                            </div>
                            <div class="facility-card">
                                <div class="facility-icon">‚ùÑÔ∏è</div>
                                <h4>AC Dining</h4>
                                <p>Comfortable air-conditioned seating</p>
                            </div>
                            <div class="facility-card">
                                <div class="facility-icon">üéµ</div>
                                <h4>Live Music</h4>
                                <p>Weekend live performances</p>
                            </div>
                            <div class="facility-card">
                                <div class="facility-icon">üå±</div>
                                <h4>Organic Options</h4>
                                <p>Fresh, locally sourced ingredients</p>
                            </div>
                            <div class="facility-card">
                                <div class="facility-icon">üë∂</div>
                                <h4>Family Friendly</h4>
                                <p>Kids menu and play area</p>
                            </div>
                        </div>

                        <div style="margin-top:20px; text-align:center;">
                            <button class="btn-amber" onclick="setState({view: 'roleSelect'})">Select Role & Continue</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRoleSelect() {
            return `
                <div class="role-selection-section min-h-screen">
                    <div class="container">
                        <h2>Select Your Role</h2>
                        <div class="role-selection">
                            <div class="role-card">
                                <h2>üë§ Customer</h2>
                                <p>Browse menu and place orders</p>
                                <button onclick="setState({currentRole: 'customer', view: 'customer'})">Continue as Customer</button>
                            </div>
                            <div class="role-card">
                                <h2>üçΩÔ∏è Waiter</h2>
                                <p>Manage customer orders</p>
                                <button onclick="setState({currentRole: 'waiter', view: 'login'})">Login as Waiter</button>
                            </div>
                            <div class="role-card">
                                <h2>üëî Owner</h2>
                                <p>View all orders and analytics</p>
                                <button onclick="setState({currentRole: 'owner', view: 'login'})">Login as Owner</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLogin() {
            const preUid = state.currentRole === 'waiter' ? (mockUsers.waiters[0].uid) : (mockUsers.owners[0].uid);
            const prePass = state.currentRole === 'waiter' ? (mockUsers.waiters[0].password) : (mockUsers.owners[0].password);
            const title = state.currentRole === 'waiter' ? 'Waiter' : 'Owner';
            return `
                <div class="min-h-screen bg-gradient-to-br" style="padding:48px; display:flex; align-items:center; justify-content:center;">
                    <div class="card" style="max-width:480px; width:100%;">
                        <button onclick="setState({view: 'roleSelect'})" style="background:none; border:none; color:#fff; margin-bottom:12px; cursor:pointer;">‚Üê Back</button>
                        <h2 style="text-align:center; font-size:28px; color:#d4a574; margin-bottom:18px;">${title} Login</h2>
                        <div style="display:flex; flex-direction:column; gap:16px;">
                            <div>
                                <label style="display:block; color:#fff; margin-bottom:6px;">User ID (UID)</label>
                                <input id="loginUid" type="text" value="${preUid}" style="width:100%; background:rgba(255,255,255,0.08); color:#fff; padding:10px; border-radius:8px; border:none;" />
                            </div>
                            <div>
                                <label style="display:block; color:#fff; margin-bottom:6px;">Password</label>
                                <input id="loginPassword" type="password" value="${prePass}" style="width:100%; background:rgba(255,255,255,0.08); color:#fff; padding:10px; border-radius:8px; border:none;" />
                            </div>
                            <button class="btn-amber" onclick="window.doLogin()">Login</button>
                            <p style="text-align:center; color:#bbb; font-size:13px;">Demo credentials are pre-filled for testing</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCustomer() {
            const total = calculateTotal();
            return `
                <div class="min-h-screen" style="padding:32px;">
                    <div class="container">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h1 style="font-size:32px;" class="text-amber">Menu</h1>
                            <div>
                                <button class="btn-amber" onclick="setState({view: 'roleSelect', cart: []})">Exit</button>
                            </div>
                        </div>

                        <div style="display:grid; grid-template-columns:2fr 1fr; gap:20px;">
                            <div>
                                ${Object.entries(menuData).map(([category, items]) => `
                                    <div style="margin-bottom:18px;">
                                        <h2 style="font-size:20px; color:#d4a574; margin-bottom:8px;">${category}</h2>
                                        <div class="grid-2">
                                            ${items.map(item => `
                                                <div class="card">
                                                    <h3 style="font-size:18px; margin-bottom:6px;">${item.name}</h3>
                                                    <p class="muted" style="font-size:13px; margin-bottom:8px;">${item.description}</p>
                                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                                        <span class="text-amber" style="font-size:18px; font-weight:bold;">$${formatCurrency(item.price)}</span>
                                                        <button class="btn-amber" onclick='addToCart(${JSON.stringify(item)})'>+ Add</button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="card" style="position:sticky; top:20px; align-self:start;">
                                <h2 style="font-size:18px; margin-bottom:12px;" class="text-amber">üõí Your Order</h2>
                                ${state.cart.length === 0 ? `
                                    <p class="muted" style="padding:24px; text-align:center;">No items added yet</p>
                                ` : `
                                    <div style="display:flex; flex-direction:column; gap:12px; margin-bottom:12px;">
                                        ${state.cart.map(it => `
                                            <div style="background:rgba(255,255,255,0.02); padding:10px; border-radius:8px;">
                                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                                                    <strong>${it.name}</strong>
                                                    <button onclick="removeFromCart(${it.id})" style="background:none; border:none; color:#ff6b6b; cursor:pointer;">‚úï</button>
                                                </div>
                                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                                    <div style="display:flex; gap:8px; align-items:center;">
                                                        <button onclick="updateQuantity(${it.id}, -1)" style="padding:6px; border-radius:6px; background:rgba(255,255,255,0.04); border:none; cursor:pointer;">-</button>
                                                        <span>${it.quantity}</span>
                                                        <button onclick="updateQuantity(${it.id}, 1)" style="padding:6px; border-radius:6px; background:rgba(255,255,255,0.04); border:none; cursor:pointer;">+</button>
                                                    </div>
                                                    <div style="font-weight:bold;">$${formatCurrency(it.price * it.quantity)}</div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>

                                    <div style="border-top:1px solid rgba(255,255,255,0.06); padding-top:12px; margin-bottom:12px;">
                                        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:18px;">
                                            <span>Total:</span>
                                            <span class="text-amber">$${total}</span>
                                        </div>
                                    </div>

                                    <button class="btn-amber" style="width:100%;" onclick="placeOrder()">Place Order</button>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderWaiter() {
            const waiterOrders = state.orders.filter(o => o.waiter === state.currentUser?.name);
            return `
                <div class="min-h-screen" style="padding:28px;">
                    <div class="container">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:18px;">
                            <h1 class="text-amber" style="font-size:28px;">Waiter Dashboard</h1>
                            <div style="display:flex; gap:12px; align-items:center;">
                                <span style="background:rgba(255,255,255,0.04); padding:8px 12px; border-radius:8px;">Welcome, ${state.currentUser?.name || ''}</span>
                                <button class="btn-amber" onclick="setState({view: 'roleSelect', currentUser: null})">Logout</button>
                            </div>
                        </div>

                        <div class="card" style="margin-bottom:18px;">
                            <h2 class="text-amber" style="margin-bottom:8px;">Current Orders</h2>
                            <div style="overflow-x:auto;">
                                <table style="width:100%; border-collapse:collapse;">
                                    <thead>
                                        <tr style="color:#d4a574; border-bottom:1px solid rgba(255,255,255,0.06); text-align:left;">
                                            <th style="padding:10px;">Table</th>
                                            <th style="padding:10px;">Order ID</th>
                                            <th style="padding:10px;">Items</th>
                                            <th style="padding:10px;">Total</th>
                                            <th style="padding:10px;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${waiterOrders.map(order => `
                                            <tr style="border-bottom:1px solid rgba(255,255,255,0.03); color:#fff;">
                                                <td style="padding:10px;">${order.tableNo}</td>
                                                <td style="padding:10px;">#${order.id}</td>
                                                <td style="padding:10px;">${order.items}</td>
                                                <td style="padding:10px;">$${formatCurrency(order.total)}</td>
                                                <td style="padding:10px;"><span style="padding:6px 10px; border-radius:999px; background:${order.status==='pending'? '#f6c84b': order.status==='preparing' ? '#4ea3ff' : '#3cd26b'}; color:#1a1a1a;">${order.status}</span></td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:12px;">
                            <div class="card">
                                <div style="font-size:28px; margin-bottom:6px;">üí∞</div>
                                <h3 class="muted">Total Earnings</h3>
                                <p style="font-size:20px; font-weight:bold;">$203.50</p>
                            </div>
                            <div class="card">
                                <div style="font-size:28px; margin-bottom:6px;">üìà</div>
                                <h3 class="muted">Commission</h3>
                                <p style="font-size:20px; font-weight:bold;">$125.50</p>
                            </div>
                            <div class="card">
                                <div style="font-size:28px; margin-bottom:6px;">‚≠ê</div>
                                <h3 class="muted">Tips Received</h3>
                                <p style="font-size:20px; font-weight:bold;">$78.00</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderOwner() {
            return `
                <div class="min-h-screen" style="padding:28px;">
                    <div class="container">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:18px;">
                            <h1 class="text-amber" style="font-size:28px;">Owner Dashboard</h1>
                            <button class="btn-amber" onclick="setState({view: 'roleSelect', currentUser: null})">Logout</button>
                        </div>

                        <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:16px;">
                            <div class="card"><h3 class="muted">Total Sales</h3><p style="font-size:20px; font-weight:bold;">$1,245.50</p></div>
                            <div class="card"><h3 class="muted">Total Orders</h3><p style="font-size:20px; font-weight:bold;">48</p></div>
                            <div class="card"><h3 class="muted">Net Profit</h3><p style="font-size:20px; font-weight:bold;">$622.25</p></div>
                            <div class="card"><h3 class="muted">Avg Order</h3><p style="font-size:20px; font-weight:bold;">$25.95</p></div>
                        </div>

                        <div class="card" style="margin-bottom:16px;">
                            <h2 class="text-amber">All Orders</h2>
                            <table style="width:100%; margin-top:8px; border-collapse:collapse;">
                                <thead>
                                    <tr style="color:#d4a574; border-bottom:1px solid rgba(255,255,255,0.06); text-align:left;">
                                        <th style="padding:10px;">Date</th>
                                        <th style="padding:10px;">Order ID</th>
                                        <th style="padding:10px;">Table</th>
                                        <th style="padding:10px;">Items</th>
                                        <th style="padding:10px;">Total</th>
                                        <th style="padding:10px;">Status</th>
                                        <th style="padding:10px;">Waiter</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.orders.map(order => `
                                        <tr style="border-bottom:1px solid rgba(255,255,255,0.03); color:#fff;">
                                            <td style="padding:10px;">${order.date}</td>
                                            <td style="padding:10px;">#${order.id}</td>
                                            <td style="padding:10px;">${order.tableNo}</td>
                                            <td style="padding:10px;">${order.items}</td>
                                            <td style="padding:10px;">$${formatCurrency(order.total)}</td>
                                            <td style="padding:10px;"><span style="padding:6px 10px; border-radius:999px; background:${order.status==='pending'? '#f6c84b': order.status==='preparing' ? '#4ea3ff' : '#3cd26b'}; color:#1a1a1a;">${order.status}</span></td>
                                            <td style="padding:10px;">${order.waiter}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div class="card">
                            <h2 class="text-amber">Waiter Performance</h2>
                            <table style="width:100%; margin-top:8px; border-collapse:collapse;">
                                <thead>
                                    <tr style="color:#d4a574; border-bottom:1px solid rgba(255,255,255,0.06); text-align:left;">
                                        <th style="padding:10px;">Name</th>
                                        <th style="padding:10px;">UID</th>
                                        <th style="padding:10px;">Orders</th>
                                        <th style="padding:10px;">Commission</th>
                                        <th style="padding:10px;">Tips</th>
                                        <th style="padding:10px;">Rating</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${mockUsers.waiters.map(w => `
                                        <tr style="border-bottom:1px solid rgba(255,255,255,0.03); color:#fff;">
                                            <td style="padding:10px;">${w.name}</td>
                                            <td style="padding:10px;">${w.uid}</td>
                                            <td style="padding:10px;">24</td>
                                            <td style="padding:10px;">$62.50</td>
                                            <td style="padding:10px;">$45.00</td>
                                            <td style="padding:10px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        /***********************
         * Event wiring for inline handlers
         ***********************/
        function attachEventListeners() {
            window.setState = setState;
            window.addToCart = addToCart;
            window.removeFromCart = removeFromCart;
            window.updateQuantity = updateQuantity;
            window.placeOrder = placeOrder;
            window.handleLogin = handleLogin;
            window.doLogin = function() {
                const uid = document.getElementById('loginUid')?.value;
                const password = document.getElementById('loginPassword')?.value;
                handleLogin(uid, password, state.currentRole);
            };
        }

        // Initial render + attach
        render();
        attachEventListeners();

    </script>
</body>

</html>
